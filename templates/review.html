{% extends "base.html" %}
{% block content %}
<div class="d-flex justify-content-between align-items-baseline">
    <h3>Review &amp; Relabel</h3>
    <div>
        <a class="btn btn-outline-secondary btn-sm" href="{{ url_for('label_next', dataset_id=dataset_id) }}">Back to
            labeling</a>
        <a class="btn btn-outline-success btn-sm" href="{{ url_for('export', dataset_id=dataset_id) }}">Export CSV</a>
    </div>
</div>
<div class="mb-2 muted">
    Dataset {{ dataset_id }} &middot;
    Yes: <b>{{ yes }}</b> &nbsp;
    No: <b>{{ no }}</b> &nbsp;
    Unlabeled: <b>{{ unlabeled }}</b> &nbsp;
    Total: <b>{{ total }}</b>
</div>

<div class="mb-3">
    <a class="btn btn-sm btn-{{ 'primary' if status=='all' else 'outline-primary' }}"
        href="{{ url_for('review', dataset_id=dataset_id, status='all') }}">All</a>
    <a class="btn btn-sm btn-{{ 'success' if status=='yes' else 'outline-success' }}"
        href="{{ url_for('review', dataset_id=dataset_id, status='yes') }}">Related</a>
    <a class="btn btn-sm btn-{{ 'danger' if status=='no' else 'outline-danger' }}"
        href="{{ url_for('review', dataset_id=dataset_id, status='no') }}">Not related</a>
    <a class="btn btn-sm btn-{{ 'secondary' if status=='unlabeled' else 'outline-secondary' }}"
        href="{{ url_for('review', dataset_id=dataset_id, status='unlabeled') }}">Unlabeled</a>
</div>

<table class="table table-hover">
    <thead>
        <tr>
            <th style="width: 70px;">ID</th>
            <th>Title</th>
            <th style="width: 80px;">Year</th>
            <th>Abstract</th>
            <th style="width: 240px;">Actions</th>
        </tr>
    </thead>
    <tbody>
        {% for a in rows %}
        <tr>
            <td class="mono">{{ a.id }}</td>
            <td>{{ a.title or '' }}</td>
            <td>
                {{ a.year or '' }}
                {% if a.extra_json %}
                {% for key, value in a.extra_json.items() %}
                {% if 'doi' in key|lower %}
                <div><a href="https://doi.org/{{ value }}" target="_blank">{{ value }}</a></div>
                {% endif %}
                {% endfor %}
                {% endif %}
            </td>

            <td class="abstract-box">{{ (a.abstract or '')[:500] }}{% if a.abstract and a.abstract|length>500 %}â€¦{%
                endif %}</td>
            <td>
                <form method="post" action="{{ url_for('relabel', article_id=a.id, status=status) }}"
                    class="d-flex flex-column gap-1">
                    <input class="form-control form-control-sm" name="notes" placeholder="Notes (optional)"
                        value="{{ a.notes or '' }}">
                    <div class="btn-group">
                        <button name="label" value="yes"
                            class="btn btn-sm btn-success {{ 'active' if a.label=='yes' else '' }}">Related</button>
                        <button name="label" value="no"
                            class="btn btn-sm btn-danger {{ 'active' if a.label=='no' else '' }}">Not</button>
                        <button name="label" value="clear" class="btn btn-sm btn-outline-secondary">Clear</button>
                    </div>
                </form>
            </td>
        </tr>
        {% else %}
        <tr>
            <td colspan="5" class="muted">No rows for this filter.</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% endblock %}